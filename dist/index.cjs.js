"use strict";const e=e=>{e.focus(),null!==e.firstChild&&window.getSelection().collapse(e.firstChild,e.firstChild.length)},t=e=>!!e&&!e.matches('[data-block-template="true"]'),o=e=>e.registeredBlocks.map(e=>e.constructor.name),r=e=>{const t=new Error(`Required parameter, "${e}" is missing.`);throw"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(t,r),t};var l={shiftBlockFocus:(t,o,r)=>{const l=[...t.querySelectorAll("[contenteditable]")],s=l.indexOf(document.activeElement);if(0!==s&&s!==l.length-1){switch(o){case"up":e(l[s-1]);break;case"down":e(l[s+1])}return}const c=r.querySelectorAll("[contenteditable]");switch(o){case"up":e(c[c.length-1]);break;case"down":e(c[0])}},shiftFieldFocus:e,moveBlock:(e,o)=>{if(!e.matches('[data-block-template="true"]'))switch(o){case"up":t(e.previousElementSibling)&&e.previousElementSibling.before(e);break;case"down":t(e.nextElementSibling)&&e.nextElementSibling.after(e)}},getRegisteredBlocksNameList:o,getBlockInstancesListFromDOM:e=>{const t=o(e);return[...e.editorContainer.childNodes].map(o=>{const r=t.indexOf(o.dataset.blockType);if(-1!==r)return e.registeredBlocks[r]})},requiredParam:r};const{shiftBlockFocus:s,shiftFieldFocus:c,moveBlock:n,getRegisteredBlocksNameList:a,getBlockInstancesListFromDOM:i,requiredParam:d}=l;var k={FreedomEditor:function({containerId:e,i18n:t,blockTemplate:o,blocksControllers:r,registeredBlocks:l,defaultBlocks:c}){let n={containerId:e||d("containerId"),i18n:t||{locale:"en-US",rtl:"auto"},blockTemplate:o||[],blocksControllers:r||[],defaultBlocks:c||d("defaultBlocks"),registeredBlocks:l?[...new Set(l)]:d("registeredBlocks")};const k=document.getElementById(e);k.setAttribute("dir",n.i18n.rtl),n.editorContainer=k,n=Object.freeze(n);const u=({blockInstance:e=d("blockInstance"),isTemplateBlock:t="false",savedData:o})=>{const r=e.render(n.i18n,o);r.dataset.order=k.childNodes.length,r.dataset.blockTemplate="true"===t;return n.blocksControllers.map(t=>{const o=e.options.controllers.find(e=>t.constructor.name===e.constructor.name);return Object.assign(t,o)}).forEach(e=>{e.init(this,r)}),k.append(r),r};return{options:n,init:(e=[])=>{if(!n.defaultBlocks.every(e=>n.registeredBlocks.includes(e)))throw new Error("You need to register all your default blocks at options.registeredBlocks");return n.blockTemplate.forEach(e=>{if(!n.registeredBlocks.includes(e))throw new Error("You need to register blocks used in your block template at options.registeredBlocks.")}),k},saveBlocks:()=>{const e=[...k.childNodes].map((e,t)=>i(n)[t].save(e)).filter(e=>void 0!==e);return{timestamp:Date.now(),data:e}},loadBlocks:e=>e?e.data.map(e=>{const t=a(n).indexOf(e.type);if(-1===t)throw new Error("You are trying to load a block that you haven't registered when you initzalize the editor");return u({blockInstance:n.registeredBlocks[t],isTemplateBlock:e.isTemplateBlock,savedData:e})}):n.blockTemplate.length>0?n.blockTemplate.map(e=>u({blockInstance:e,isTemplateBlock:"true"})):n.defaultBlocks.map(e=>u({blockInstance:e,isTemplateBlock:"false"})),resetBlocks:()=>{[...k.childNodes].forEach(e=>{e.matches('[data-block-template="true"]')?e.querySelectorAll("[contenteditable]").forEach(e=>{e.textContent=""}):e.remove()}),0===k.childNodes.length&&n.defaultBlocks.forEach(e=>{u({blockInstance:e,isTemplateBlock:!1})})},renderBlock:u,removeBlock:e=>{e.matches('[data-block-template="true"]')||1===k.childNodes.length||(e!==k.firstElementChild?s(e,"up",e.previousElementSibling):s(e,"down",e.nextElementSibling),e.remove())}}}};module.exports=k;
